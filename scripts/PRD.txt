# **EaglePass â€“ Digital Hall Pass System**  
*Functional Requirements (concise) â€“ Rev 06 / 26 / 2025*

---

## 1  Pass Lifecycle
| Step | Condition | Result |
|------|-----------|--------|
| **Start** | Student leaves scheduled location | `open out` leg |
| **Check-in** | Location â‰  scheduled | `open in` leg (pass stays open) |
| **Return** | Location = scheduled | `closed in` â†’ pass ends |
| **Restroom** | Not check-in eligible | Must return to origin |
| **Parking Lot** | Staff/Admin issued only | No student initiation |

*Exactly **one active pass** per student.*

---

## 2  Logging
- **Immutable legs**: `timestamp, passId, studentId, locationId, actorId, direction, legNumber`  
- **Durations** calculated at query time

---

## 3  Escalations
| Level | Default | Notify |
|-------|---------|--------|
| `durationWarning` | 10 min | student, origin staff, current staff |
| `durationAlert`   | 20 min | + admin |

*Thresholds configurable (global / location / student).*

---

## 4  Location Responsibility
```json
location = {
  locationId,
  staffAssignments: [
    { staffId, role, periods[] | null, isPrimary? }
  ],
  shared: true | false
}
```
Staff may override location per period; planning periods can block passes.

---

## 5  Student Schedule
```json
periodAssignment = { periodId, staffId }
```
Location resolved via staffâ€™s period location.  
Edits forward-only; all changes logged.

---

## 6  Permission Hierarchy
**Admin > Group Pass > Location > Student** (most restrictive wins)  
Modes: **allow Â· require approval Â· block**

---

## 7  Groups & Group Passes
- Positive / negative groups created by staff/admin  
- Group pass overrides location/student rules unless an admin block exists  
- Admin settings: auto-approve Â· pre-approve Â· notifications Â· cancel

---

## 8  Roles & Capabilities
| Role | Key Actions |
|------|-------------|
| **Student** | Create / check-in / return; view own history |
| **Teacher / Support** | Issue passes; override in own location; create groups; force â€œreturnedâ€; flag â€œFound w/o Passâ€; full reporting |
| **Admin** | Full CRUD; global settings; force-close; manage roles, groups, schedules; view/export logs |

---

## 9  Authentication
- **Google SSO** (MVP) â€“ domain-restricted  
- Architecture ready for Microsoft SSO & email/password  
- Unknown users â†’ pending page â†’ admin approval  
- **Multi-role support** (e.g., admin + teacher)

---

## 10  Reporting
- All staff: full reporting & CSV/Sheets export  
- Pre-built filters: **Frequent Flyers Â· Stall Sitters Â· Period Heatmaps**  
- Export warning re: PII

---

## 11  Data Import / Sync
- Bulk CSV/Sheet for students, staff, locations, schedules  
- Manual UI edits **+ optional REST API sync**  
- Period change â†’ auto force-close (unless `extendThroughPeriod`)  
- Historical logs *immutable*

---

## 12  FERPA & Security
- Role-based access; audit log of all actions  
- Only users with legitimate educational interest may view student data  
- Email alerts exclude PII; detailed data only in secure UI  
- Data retention per district policy; deletion only by admin  
- â€œFound w/o Passâ€ and all overrides recorded for audit

---

## 13  App Definition
**Name:** **EaglePass**  
**Tagline:** *â€œSimple, transparent student movement.â€*

---

## 14  Tech Stack
| Layer | Choice | Rationale |
|-------|--------|-----------|
| **Frontend** | React + Vite (TypeScript), PWA-ready; Tailwind CSS & shadcn/ui | Fast DX, easy theming, offline-capable |
| **Backend** | Firebase (Cloud Firestore, Cloud Functions, Auth) | Serverless scale; tight SSO integration |
| **Realtime** | Firestore listeners | Live dashboards without polling |
| **Hosting / CDN** | Firebase Hosting + Cloudflare proxy | Global edge caching |
| **Analytics** | BigQuery export + Data Studio templates | District-level insights |
| **Mobile** | Installable PWA; optional React Native wrapper | Single codebase, app-store presence |

---

## 15  Database Schema (Firestore collections)
- `passes/{id}` â†’ summary doc (studentId, status, openedAt, closedAt)  
- `legs/{passId}/{legId}` â†’ immutable leg docs  
- `students/{id}` Â· `staff/{id}` Â· `locations/{id}` Â· `groups/{id}` Â· `schedules/{term}`  
- Composite indexes: `(studentId,status)` and `(locationId,openedAt)` for heatmaps

---

## 16  API Integrations
| Type | Purpose | Status |
|------|---------|--------|
| **OIDC (SSO)** | Google Workspace â†” Auth | MVP |
| **OneRoster v1.2** | Roster import from any SIS | v1 |
| **Clever / ClassLink** | Optional auto-sync | Backlog |
| **Webhook / Events** | Push escalations to Slack, Teams, SMS | v1 |
| **District SFTP** | Nightly CSV drop for schools without API | Fallback |

---

## 17  Design Style
- **Mobile-first**, 100 % PWA; WCAG 2.1 AA contrast  
- **Color-coded states** (green â†’ yellow â†’ red) mirror escalation timers  
- Simple card-based layout; large touch targets â‰¥ 48 px  
- Consistent lucide-react icons; motion fades for state changes  
- Dark-mode by default; respects OS preference

---

## 18  Out-of-Scope (Wonâ€™t Build)
- Bluetooth/iBeacon or CCTV location tracking  
- Nurse, counseling or visitor-management modules  
- Tardy slips & discipline consequence automation  
- In-house payment processing or fee collection  
- Hardware badge scanners / kiosks (integrate via API if district supplies)  
- Parent messaging portal (handled by SIS)

---

## 19  Competitive Snapshot (MVP vs. Market Leaders)

| Feature | **Securly Pass** | **Campus Workflow Suite** | **EaglePass (MVP)** |
|---------|------------------|---------------------------|---------------------|
| Daily & location pass limits | âœ… Built-in limits & â€œmeet-upâ€ blocks | âš ï¸ Custom rules | âœ… Configurable thresholds |
| Live dashboard | âœ… Auto-updating | âœ… Hall monitor view | âœ… Firestore realtime |
| Appointment passes | âœ… Schedule & notify | âš ï¸ Via attendance module | â¬œ Planned post-MVP |
| Badge/kiosk scans | âš™ï¸ Kiosk mode only | âœ… ID badges & kiosks | â¬œ API hooks only |
| SIS integration | âœ… Auto-provision SIS | âœ… Native (Infinite Campus) | âœ… OneRoster/Clever |
| Lock-down â€œfreeze all passesâ€ | ğŸš« Not listed | ğŸš« Not listed | âœ… Global *Pass Freeze* toggle |
| Pricing model | Per-student SaaS | Add-on to IC SIS | Flat-tier SaaS / site license |

**Differentiators**  
1. **Open data export** (BigQuery) without extra fees  
2. **Code-enforced FERPA masking** in exports  
3. **Pass Freeze** & period auto-close baked into lifecycle  
4. Lightweight PWAâ€”runs on any device, no dedicated kiosks

---

## 20  Next Research Items
1. **Appointment Pass UX** â€“ study Securlyâ€™s flow for friction points  
2. **Barcode kiosk-less scans** (QR in PWA) to match Campus Workflow strength  
3. **Behavioral analytics** â€“ evaluate anomaly-detection APIs for frequent flyers
